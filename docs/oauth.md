## RFC 6749 OAuth 2.0 Authorization Framework

[OAuth](https://tools.ietf.org/html/rfc6749)

### Roles
1. The Third-Party Application: "Client"
    1. The client is the application that is attempting to get access to the user's account. It needs to get permission from the user before it can do so.
2. The API: "Resource Server"
    1. The resource server is the API server used to access the user's information.
3. The Authorization Server
    1. This is the server that presents the interface where the user approves or denies the request. In smaller implementations, this may be the same server as the API server, but larger scale deployments will often build this as a separate component.
4. The User: "Resource Owner"
    1. The resource owner is the person who is giving access to some portion of their account.

### Creating an application for OAuth
When registering a new app, you usually register basic information such as application name, website, a logo, etc.
In addition, you must register a redirect URI to be used for redirecting users to for web server, browser-based, or mobile apps.

#### Redirect URIs
Any HTTP redirect URIs must be protected with TLS security, so the service will only redirect to URIs beginning with "https".
This prevents tokens from being intercepted during the authorization process.

*Remember that HTTP is a clear text protocol*
*Someone can easily sniff packets with tools like Wireshark and see passwords, etc.*

#### Client ID and Secret
Upon registering your app, you will receive a client id and secret

1. The client ID is considered public information, and is used to build login URLs, or included in Javascript source code on a page.
2. The client secret must be kept confidential.
    1. If a deployed app cannot keep the secret confidential, such as single-page Javascript apps or native apps, then the secret is not used, and ideally the service shouldn't issue a secret to these types of apps in the first place.

### Authorization

OAuth 2 provides several "grant types" for different use cases. The grant types defined are:

1. Authorization Code for apps running on a web server, browser-based and mobile apps.
2. Password for logging in with a username and password
3. Client credentials for application access
4. Implicit was previously recommended for clients without a secret, but has been superceded by using the Authorization Code grant with no secret.

### Token Exchange

Client Request

`https://oauth2server.com/auth?response_type=code&client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&scope=photos&state=1234zyx`

```http
POST https://api.oauth2server.com/token
  grant_type=authorization_code
  &code=AUTH_CODE_HERE
  &redirect_uri=REDIRECT_URI
  &client_id=CLIENT_ID
  &client_secret=CLIENT_SECRET
```

*Remember the ampersand (&) is a query string separator which are appended to urls*

Break down of the query

1. `grant_type=authorization_code` - The grant type for this flow is authorization_code
2. `code=AUTH_CODE_HERE` - This is the code you received in the query string
3. `redirect_uri=REDIRECT_URI` - Must be identical to the redirect URI provided in the original link
4. `client_id=CLIENT_ID` - The client ID you received when you first created the application
5. `client_secret=CLIENT_SECRET` - Since this request is made from server-side code, the secret is included

Server responds with this possible 200 response

```json
{
  "access_token": "RsT5OjbzRn430zqMLgV3Ia",
  "expires_in": 3600
}
```

Or this possible 500 level HTTP Error response

```json
{
  "error": "invalid_request"
}
```


#### Single-Page Apps

GET request from client `https://oauth2server.com/auth?response_type=code&client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&scope=photos&state=1234zyx`

Newer query string parameters

1. scope - One or more scope values indicating which parts of the user's account you wish to access
2. state - A random string generated by your application, which you'll verify later

## Other Grant Types

OAuth 2 also provides a "password" grant type which can be used to exchange a username and password for an access token directly.
Since this obviously requires the application to collect the user's password, it must only be used by apps created by the service itself.

```http
POST https://api.oauth2server.com/token
  grant_type=password&
  username=USERNAME&
  password=PASSWORD&
  client_id=CLIENT_ID
```

1. `grant_type=password` - The grant type for this flow is password
2. `username=USERNAME` - The user's username as collected by the application
3. `password=PASSWORD` - The user's password as collected by the application
4. `client_id=CLIENT_ID` - The client ID you received when you first created the application

Sample Curl Request with bearer token
```bash
curl -H "Authorization: Bearer RsT5OjbzRn430zqMLgV3Ia" \
https://api.oauth2server.com/1/me
```
